<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FamFilmFav</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class="container">
      <header>
        <h1>FamFilmFav</h1>
        <div id="headerActions">
          <span id="serverStatus" style="display: none; margin-right: 10px; font-size: 12px;"></span>
          <button id="settingsBtn" onclick="openSettings()" style="display: none;">Settings</button>
        </div>
      </header>
      
      <div class="content">
        <div class="welcome-message">
          <h2>Welcome to FamFilmFav</h2>
          <p>Your family film favorites manager</p>
          
          <div class="info-box">
            <p><strong>App Version:</strong> <span id="appVersion">Loading...</span></p>
            <p><strong>Access:</strong> <span id="accessInfo">Loading...</span></p>
          </div>
          
          <div style="margin-top: 30px; text-align: left;">
            <h3>Getting Started</h3>
            <ul style="text-align: left; display: inline-block; margin-top: 10px;">
              <li>Click "Settings" to configure the app</li>
              <li>Access the web version at <span id="webAccessUrl">http://localhost:3000</span></li>
              <li>Right-click the tray icon for menu options</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      // Detect if running in Electron or browser
      const isElectron = typeof window.electron !== 'undefined';
      
      async function openSettings() {
        if (isElectron) {
          await window.electron.openSettings();
        }
      }
      
      // Initialize based on environment
      window.addEventListener('DOMContentLoaded', async () => {
        const settingsBtn = document.getElementById('settingsBtn');
        const accessInfo = document.getElementById('accessInfo');
        const serverStatus = document.getElementById('serverStatus');
        const webAccessUrl = document.getElementById('webAccessUrl');
        
        if (isElectron) {
          // Desktop app environment
          settingsBtn.style.display = 'block';
          
          try {
            const port = await window.electron.getServerPort();
            const url = `http://localhost:${port}`;
            webAccessUrl.textContent = url;
            accessInfo.textContent = `This UI is also accessible at: ${url}`;
          } catch (error) {
            console.error('Error loading server port:', error);
          }
          
          try {
            const version = await window.electron.getAppVersion();
            document.getElementById('appVersion').textContent = version;
          } catch (error) {
            console.error('Error loading app version:', error);
          }
        } else {
          // Web browser environment
          accessInfo.textContent = 'Web Version - Access from any device on your network';
          webAccessUrl.textContent = window.location.origin;
          
          try {
            const versionResponse = await fetch('/api/version');
            const versionData = await versionResponse.json();
            document.getElementById('appVersion').textContent = versionData.version;
          } catch (error) {
            console.error('Error loading version:', error);
            document.getElementById('appVersion').textContent = 'Error loading version';
          }
          
          try {
            const healthResponse = await fetch('/api/health');
            if (healthResponse.ok) {
              serverStatus.textContent = '✓ Server Online';
              serverStatus.style.color = '#155724';
              serverStatus.style.display = 'inline';
            }
          } catch (error) {
            console.error('Server error:', error);
            serverStatus.textContent = '✗ Server Offline';
            serverStatus.style.color = '#721c24';
            serverStatus.style.display = 'inline';
          }
        }
      });
    </script>
  </body>
</html>
